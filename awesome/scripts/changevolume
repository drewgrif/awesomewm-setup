#!/bin/bash

# This version of changevolume uses awesome-client to send notifications through naughty
# instead of using dunstify

function send_notification() {
    volume=$(pamixer --get-volume)
    
    # Create a lua command that will send a notification through naughty
    lua_command="local naughty = require('naughty')
    naughty.notify({
        title = 'Volume',
        text = 'Volume: ${volume}%',
        timeout = 2,
        icon = 'volume-$1',
        replaces_id = 9993,
        urgency = 'low',
        preset = naughty.config.presets.low,
        bg = '#161616',
        fg = '#ffffff',
        width = 300,
        height = 100
    })"
    
    # Send the command to awesome-client
    echo "$lua_command" | awesome-client
}

case $1 in
up)
    # Set the volume on (if it was muted)
    pamixer -u
    pamixer -i 2 --allow-boost
    send_notification $1
    ;;
down)
    pamixer -u
    pamixer -d 2 --allow-boost
    send_notification $1
    ;;
mute)
    pamixer -t
    if $(pamixer --get-mute); then
        # Create a lua command for mute notification
        lua_command="local naughty = require('naughty')
        naughty.notify({
            title = 'Volume',
            text = 'Muted',
            timeout = 2,
            icon = 'volume-mute',
            replaces_id = 9993,
            urgency = 'low',
            preset = naughty.config.presets.low,
            bg = '#161616',
            fg = '#ffffff',
            width = 300,
            height = 100
        })"
        
        # Send the command to awesome-client
        echo "$lua_command" | awesome-client
    else
        send_notification up
    fi
    ;;
esac
